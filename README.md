# gengo2002

知能情報システム工学実験2A「言語処理系」の実験用ソースコード

このリポジトリには，以下のソフトウェアが含まれています．

- znc（ZINC言語のコンパイラ）
- p386（エミュレータ）
- znas（ZINC言語のアセンブラ）

<!-- ## 動作環境 -->

## インストールと動作確認

### 1. ソースコードのインストール

#### 実験サイトからインストール

実験サイトは [https://web.tuat.ac.jp/~k1kaneko/gengo/index.html](https://web.tuat.ac.jp/~k1kaneko/gengo/index.html) です．
> このサイトでは，実験用ソースコードの他にも，ソースコードに関する資料や金子研究室の学生による補足PDFドキュメントが配布されています．

サイト上部にある`gengo2002.tar.gz`へのリンクを右クリックし，
右クリックメニューの中から「名前を付けてリンク先を保存」を選択します．

> ご使用のブラウザによって（ほぼ確実に），セキュリティ関連の警告が出たり，ダウンロードがブロックされたりしますが，「保存」を選択してください．

ダウンロードされたファイルは圧縮されているので解凍する必要があります．
適宜ファイルを実験用ディレクトリに移動させたら，ディレクトリをターミナルで開き以下を入力して解凍します．

```bash
tar -xvzf gengo2002.tar.gz
```

#### このリポジトリからクローン

GitやGitHubの使用経験がある方なら，このリポジトリからクローンする方法が簡単です．

実験用のディレクトリをターミナルで開き，以下のコマンドを実行してクローンしてください．

```bash
git clone https://github.com/HiroTNK1118/gengo2002.git
```

### 2. ソフトウェアのビルド

ソースコードの解凍もしくはクローンが完了したら`gengo2002`というディレクトリができるので，お好きなエディタで開きます．

zncとp386はC言語で記述されたプログラムなのでコンパイルして使用します．

> znasはawkというシェルスクリプトの一種で記述されており，コンパイルせず実行できます．

#### 2.1. zncのビルド

まず，zncをビルドするために，`gengo2002`ディレクトリから`gengo2002/zinc-0`ディレクトリに移動します．
エディタ付属のターミナル等で以下のコマンドを実行します．

```bash
cd zinc-0
```

`make`コマンドでビルドします．以下のコマンドを順に実行します．

```bash
make clean
make znc
```

>zncやp386のビルド時におびただしい数の`warning`が出ると思いますが，これは古い仕様のC言語で記述されているためです．実験には支障がないはずなので無視してください．

`znc`という実行ファイルが生成されたらビルドは完了です．

#### 2.1. p386のビルド

次に，p386をビルドするために，`gengo2002/zinc-0`ディレクトリから`gengo2002/p386`ディレクトリに移動します．以下のコマンドを実行します．

```bash
cd ../p386
```

`make`コマンドでビルドします．以下のコマンドを順に実行します．

```bash
make clean
make p386
```

`p386`という実行ファイルが生成されたらビルドは完了です．

### 3. 動作確認（ZINCプログラムのビルドと実行）

ZINCプログラムのビルドと実行の一連の流れについて動作確認を行います．

ZINCプログラムはC言語のようなコンパイラ言語であり，以下のファイル形式からなります．

- `*.Zn`（ZINCソースファイル）
- `*.s`（ZINCアセンブラファイル）
- `*.p3`（p386エミュレータ用実行ファイル）

> ZINCは _ZINC Is Not C_ または _Zinc Is Not Carbon_ のアクロニム（頭字語）とされています．

次の流れでZINCソースコードを実行します．

`*.Zn`⇒（zncでコンパイル）⇒`*.s`⇒（znasでアセンブル）⇒`*.p3`⇒（p386で実行）

例として，最大公約数（GCD）を求めるZINCソースコード`gcd.Zn`で動作確認をします．

インストール直後ならこのファイルは`zinc-0/test`ディレクトリにあるので，エディタ付属のターミナルで`zinc-0`ディレクトリを開いておきます．

`gcd.Zn`はファイル内で次のように定義される整数`x`と`y`の最大公約数を求めます．

```txt
defproc _main :
{
  set x := 1203 * 7;
  set y := 371 * 7;
  call gcd;
  call putword;
  putchar 10;
}
```

このままだと正常に実行できない時があるので`x`と`y`を次のように変更します．

```txt
  set x := 25649;
  set y := 1651;
```

変更出来たら，zncでコンパイルするために`zinc-0`にコピーします．

```bash
cp ./test/gcd.Zn .
```

以下のコマンドを実行して，ZINCソースコードからコンパイルしたアセンブラファイル`gcd.s`を`znas`ディレクトリに配置します．

```bash
./znc < gcd.Zn > ../znas/gcd.s
```

> `<`や`>`はリダイレクトといい，指定したファイルをプログラムの標準入出力にします．

次に，znasでアセンブルするために`zinc-0`ディレクトリから`znas`ディレクトリに移動します．

```bash
cd ../znas
```

以下のコマンドを実行して，アセンブラファイルを機械語に変換した`gcd.p3`を`p386`ディレクトリに配置します．

```bash
./znas < gcd.s > ../p386/gcd.p3
```

最後に，p386で実行するために`znas`ディレクトリから`p386`ディレクトリに移動します．

```bash
cd ../p386
```

以下のコマンドを実行して，エミュレータで`gcd.p3`を実行します．（注意：リダイレクトなし）

```bash
./p386 gcd.p3
```

実行中に，実行モードの入力を求められるので，`g`と入力しておきましょう．\
以下の実行結果が得られたら成功です．

```text
13
HALT
```

動作確認が完了したら，実験課題に取り組んでください．

何かわからないことがあったら何でもTAに聞いてください，早く進めて，早く帰りましょう！！
